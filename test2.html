<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>TradingView-Style Kline (Y-Fixed Final)</title>
<style>
  html,body{margin:0;background:#0d1117;height:100%;}
  #main{width:100%;height:100%;}
</style>
<script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
</head>
<body>
<div id="main"></div>

<script>
// ======= 1) ç”Ÿæˆ K çº¿æ•°æ® =======
function gen(n=500){
  let d=[],o=[]; let t=+new Date(2023,0,1),p=100;
  for(let i=0;i<n;i++){
    t+=86400000;
    let op=p+(Math.random()-0.5)*3;
    let cl=op+(Math.random()-0.5)*4;
    let hi=Math.max(op,cl)+Math.random()*2;
    let lo=Math.min(op,cl)-Math.random()*2;
    p=cl;
    d.push(echarts.format.formatTime("yyyy-MM-dd",t));
    o.push([+op.toFixed(2),+cl.toFixed(2),+lo.toFixed(2),+hi.toFixed(2)]);
  }
  return {d,o};
}
const data=gen();

// ======= 2) é¢„è®¡ç®—å…¨å±€æœ€é«˜/æœ€ä½ï¼ˆçœŸæ­£å›ºå®šYè½´å…³é”®ï¼‰ =======
const globalHigh = Math.max(...data.o.map(v=>v[3]));
const globalLow  = Math.min(...data.o.map(v=>v[2]));
const pad = (globalHigh - globalLow)*0.08; // æ¨è 5~10%

// ======= 3) Xè½´å§‹ç»ˆé”å³ä¾§æœ€æ–°K =======
let start=88,end=100; // æ˜¾ç¤ºå³ä¾§æœ«æ®µ

const chart=echarts.init(document.getElementById("main"));

// ======= 4) ä¸»æ¸²æŸ“ï¼ˆYè½´å·²æ°¸ä¹…å›ºå®šï¼‰ =======
function render(){
chart.setOption({
  animation:false,
  backgroundColor:"#0d1117",

  grid:[{left:55,right:40,top:40,bottom:60}],

  xAxis:[{
    type:"category",data:data.d,boundaryGap:false,
    min:start+"%",max:end+"%",
    axisLabel:{color:"#aaa"},
    axisLine:{lineStyle:{color:"#444"}},
  }],

  // ======= ğŸ”¥ Yè½´æ°¸ä¸å†éšç¼©æ”¾å˜åŠ¨ =======
  yAxis:[{
    min: globalLow - pad,
    max: globalHigh + pad,
    scale:false,                    // ç»å¯¹ç¦æ­¢è‡ªé€‚åº”
    axisLabel:{color:"#aaa"},
    splitLine:{lineStyle:{color:"#333"}},
    axisLine:{lineStyle:{color:"#444"}},
  }],

  // ======= ä»…ä¿ç•™ inside æ‹–åŠ¨ï¼Œä¸äº¤ç»™ç³»ç»Ÿç¼©æ”¾ =======
  dataZoom:[{
    type:"inside",
    zoomOnMouseWheel:false,  // â—å…³é—­ç³»ç»Ÿç¼©æ”¾
    moveOnMouseMove:true,    // å…è®¸æ‹–åŠ¨çœ‹å†å²
    moveOnMouseWheel:false,
    start:start,end:end
  }],

  series:[{
    type:"candlestick",
    data:data.o,
    itemStyle:{
      color:"#26a69a",color0:"#ef5350",
      borderColor:"#26a69a",borderColor0:"#ef5350",
      borderWidth:1.2
    }
  }]
});
}
render();


// ======= 5) è‡ªå®šä¹‰ç¼©æ”¾ï¼ˆæ°¸é”å³ä¾§ï¼‰ =======
const zr=chart.getZr();
const zoom = 0.18;        // ç¼©æ”¾é€Ÿåº¦å¯è°ƒ
const minSpan=2,maxSpan=100;

zr.on("mousewheel",(ev)=>{
  const e=ev.event||ev;
  let d=e.wheelDelta!=null?e.wheelDelta:-e.deltaY;
  let span=end-start;

  if(d>0) span*=1+zoom;   // ç¼©å° â†’ æ‰©å¤§è§†å›¾
  if(d<0) span*=1-zoom;   // æ”¾å¤§ â†’ ç¼©å°è§†å›¾

  span=Math.max(minSpan,Math.min(maxSpan,span));

  start=100-span;         // ğŸ”¥æ°¸è¿œé”å³ä¾§æœ€æ–°K
  render();               // â†’ Yè½´ä¸ä¼šå†å˜
});

window.onresize=()=>chart.resize();
</script>
</body>
</html>
