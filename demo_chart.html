<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Demo · Daily P&L Bar Chart</title>
    <style>
      :root { --bg: #0f172a; --panel: #0b1220; --text: #1f2937; --muted: #6b7280; --accent: #22c55e; --grid: rgba(148,163,184,0.18); }
      * { box-sizing: border-box; }
      html, body { height: 100%; }
      body { margin: 0; background: #fff; color: #111827; font: 14px/1.5 -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Noto Sans", sans-serif; }
      .wrap { max-width: 980px; margin: 28px auto; padding: 0 16px; }
      .chart-header { display: flex; align-items: baseline; gap: 10px; color: #111827; }
      .chart-header .title { font-weight: 700; font-size: 18px; }
      .chart-header .currency { color: #6b7280; font-size: 12px; }
      .chart { height: 300px; margin-top: 8px; background:
        radial-gradient(circle, var(--grid) 1px, transparent 1px) 0 0/12px 12px; }
    </style>
  </head>
  <body>
    <div class="wrap">
      <div class="chart-header"><span class="title">Daily P&amp;L</span><span class="currency">USD ▾</span></div>
      <div id="chart" class="chart"></div>
      <div class="chart-header" style="margin-top:20px;"><span class="title">Daily P&amp;L · Outline</span><span class="currency">USD ▾</span></div>
      <div id="chartOutline" class="chart"></div>
    </div>
    <script src="https://unpkg.com/echarts@5/dist/echarts.min.js"></script>
    <script>
      const el = document.getElementById('chart');
      const chart = echarts.init(el, null, { renderer: 'canvas' });
      const dates = [];
      for (let d = 1; d <= 31; d++) {
        const mm = d < 10 ? `11/0${d}` : `11/${d}`;
        dates.push(mm);
      }
      dates.push('12/01');
      const values = dates.map((_, i) => {
        if (i === 1) return 600;
        if (i === 2) return 780;
        if (i === 3) return 520;
        if (i === 4) return 860;
        if (i === 7) return 480;
        if (i === 8) return 420;
        if (i === 12) return 560;
        if (i === 13) return 580;
        return 0;
      });
      const option = {
        grid: { left: 40, right: 24, top: 18, bottom: 36 },
        xAxis: {
          type: 'category',
          data: dates,
          axisLine: { show: false },
          axisTick: { show: false },
          axisLabel: {
            color: '#6b7280',
            formatter: (val, idx) => val,
            interval: 1
          }
        },
        yAxis: {
          type: 'value',
          min: -1000,
          max: 1000,
          interval: 1000,
          axisLine: { show: false },
          axisTick: { show: false },
          axisLabel: {
            color: '#6b7280',
            formatter: (v) => v === 0 ? '0' : (v > 0 ? '1K' : '-1K')
          },
          splitLine: { show: false }
        },
        series: [
          {
            type: 'pictorialBar',
            data: values,
            symbol: 'rect',
            symbolSize: [7, 7],
            symbolMargin: 3,
            symbolRepeat: true,
            symbolBoundingData: 1000,
            itemStyle: {
              color: '#14b8a6'
            },
            emphasis: {
              itemStyle: {
                color: '#0d9488',
                shadowBlur: 8,
                shadowColor: 'rgba(20,184,166,0.35)'
              }
            },
            animationDurationUpdate: 300
          },
          {
            type: 'line',
            data: values.map(() => 0),
            lineStyle: { color: '#9ca3af', width: 2, type: 'dashed' },
            symbol: 'none',
            z: 1
          }
        ],
        tooltip: {
          show: true,
          trigger: 'axis',
          axisPointer: { type: 'shadow', shadowStyle: { color: 'rgba(20,184,166,0.08)' } },
          backgroundColor: '#f9fafb',
          borderColor: '#e5e7eb',
          textStyle: { color: '#111827' },
          formatter: (params) => {
            const p = params[0];
            const v = values[p.dataIndex] || 0;
            const sign = v >= 0 ? '' : '-';
            return `${dates[p.dataIndex]}<br/>P&L: ${sign}$${Math.abs(v).toLocaleString()}`;
          }
        }
      };
      chart.setOption(option);
      window.addEventListener('resize', chart.resize);

      const chart2 = echarts.init(document.getElementById('chartOutline'), null, { renderer: 'canvas' });
      const data2 = dates.map((d, i) => [d, values[i]]);
      const option2 = {
        grid: { left: 40, right: 24, top: 18, bottom: 36 },
        xAxis: {
          type: 'category',
          data: dates,
          axisLine: { show: false },
          axisTick: { show: false },
          axisLabel: { color: '#6b7280', interval: 1 }
        },
        yAxis: {
          type: 'value',
          min: -1000,
          max: 1000,
          interval: 1000,
          axisLine: { show: false },
          axisTick: { show: false },
          axisLabel: { color: '#6b7280', formatter: (v) => v === 0 ? '0' : (v > 0 ? '1K' : '-1K') },
          splitLine: { show: false }
        },
        series: [
          {
            type: 'custom',
            name: 'outline',
            data: data2,
            renderItem: (params, api) => {
              const cat = api.value(0);
              const val = api.value(1);
              const p0 = api.coord([cat, 0]);
              const p1 = api.coord([cat, val]);
              const cx = p0[0];
              const y0 = p0[1];
              const y1 = p1[1];
              const topY = Math.min(y0, y1);
              const height = Math.abs(y0 - y1);
              const band = api.size([1, 0])[0];
              const dot = 3;
              const gap = 5;
              const width = Math.min(20, band - 8);
              const left = cx - width / 2;
              const right = left + width - dot;
              const bottom = topY + height - dot;
              if (height <= dot) return null;
              const nV = Math.max(1, Math.floor((height - dot) / (dot + gap)) + 1);
              const nH = Math.max(1, Math.floor((width - dot) / (dot + gap)) + 1);
              const children = [];
              for (let i = 0; i < nV; i++) {
                const y = topY + i * (dot + gap);
                children.push({ type: 'rect', shape: { x: left, y, width: dot, height: dot }, style: { fill: '#14b8a6' } });
                children.push({ type: 'rect', shape: { x: right, y, width: dot, height: dot }, style: { fill: '#14b8a6' } });
              }
              for (let j = 1; j < Math.max(0, nH - 1); j++) {
                const x = left + j * (dot + gap);
                children.push({ type: 'rect', shape: { x, y: topY, width: dot, height: dot }, style: { fill: '#14b8a6' } });
                children.push({ type: 'rect', shape: { x, y: bottom, width: dot, height: dot }, style: { fill: '#14b8a6' } });
              }
              return { type: 'group', children, silent: false };
            },
            emphasis: { focus: 'self' }
          },
          {
            type: 'line',
            data: values.map(() => 0),
            lineStyle: { color: '#9ca3af', width: 2, type: 'dashed' },
            symbol: 'none',
            z: 1
          }
        ],
        tooltip: {
          show: true,
          trigger: 'axis',
          axisPointer: { type: 'shadow', shadowStyle: { color: 'rgba(20,184,166,0.08)' } },
          backgroundColor: '#f9fafb',
          borderColor: '#e5e7eb',
          textStyle: { color: '#111827' },
          formatter: (params) => {
            const p = params[0];
            const v = values[p.dataIndex] || 0;
            const sign = v >= 0 ? '' : '-';
            return `${dates[p.dataIndex]}<br/>P&L: ${sign}$${Math.abs(v).toLocaleString()}`;
          }
        }
      };
      chart2.setOption(option2);
      window.addEventListener('resize', chart2.resize);
    </script>
  </body>
</html>
