<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI 日报</title>
<style>
  :root {
    --bg: #faf9f6;
    --surface: #ffffff;
    --text: #1d1d1f;
    --text-secondary: #6e6e73;
    --text-light: #86868b;
    --accent: #0071e3;
    --border: #e8e8ed;
    --border-light: #f2f2f7;
    --tag-bg: #f2f2f7;
    --excerpt-bg: #f9f9fb;
    --font: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Helvetica Neue', 'PingFang SC', 'Noto Sans SC', system-ui, sans-serif;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    font-family: var(--font);
    background: var(--bg);
    color: var(--text);
    line-height: 1.8;
    -webkit-font-smoothing: antialiased;
  }

  /* ── Header ── */
  .header {
    max-width: 640px;
    margin: 0 auto;
    padding: 3.5rem 1.5rem 1.8rem;
  }
  .header .label {
    font-size: 0.72rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--text-light);
    font-weight: 500;
    margin-bottom: 0.5rem;
  }
  .header h1 {
    font-size: 1.9rem;
    font-weight: 700;
    line-height: 1.3;
    color: var(--text);
    margin-bottom: 0.6rem;
  }
  .header .meta {
    font-size: 0.82rem;
    color: var(--text-light);
  }

  /* ── Date Nav ── */
  .date-nav {
    max-width: 640px;
    margin: 0 auto;
    padding: 0 1.5rem;
    display: flex;
    align-items: center;
    gap: 0.6rem;
    border-bottom: 1px solid var(--border);
    padding-bottom: 1.5rem;
  }
  .date-nav button {
    background: none;
    border: 1px solid var(--border);
    border-radius: 8px;
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    color: var(--text-secondary);
    font-size: 1rem;
    transition: all 0.15s;
  }
  .date-nav button:hover:not(:disabled) {
    border-color: var(--accent);
    color: var(--accent);
  }
  .date-nav button:disabled {
    opacity: 0.3;
    cursor: not-allowed;
  }
  .date-picker-wrap {
    position: relative;
    flex: 1;
  }
  .date-display {
    font-size: 0.9rem;
    font-weight: 500;
    color: var(--text);
    cursor: pointer;
    padding: 6px 12px;
    border-radius: 8px;
    border: 1px solid transparent;
    transition: all 0.15s;
    display: inline-flex;
    align-items: center;
    gap: 6px;
  }
  .date-display:hover {
    border-color: var(--border);
    background: var(--tag-bg);
  }
  .date-display .arrow {
    font-size: 0.6rem;
    color: var(--text-light);
  }
  .date-dropdown {
    display: none;
    position: absolute;
    top: calc(100% + 4px);
    left: 0;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    box-shadow: 0 8px 30px rgba(0,0,0,0.08);
    max-height: 280px;
    overflow-y: auto;
    z-index: 100;
    min-width: 180px;
    padding: 6px;
  }
  .date-dropdown.open { display: block; }
  .date-dropdown .date-item {
    padding: 8px 12px;
    font-size: 0.85rem;
    color: var(--text-secondary);
    cursor: pointer;
    border-radius: 8px;
    transition: background 0.1s;
  }
  .date-dropdown .date-item:hover {
    background: var(--tag-bg);
    color: var(--text);
  }
  .date-dropdown .date-item.active {
    background: var(--accent);
    color: #fff;
  }

  /* ── Content ── */
  .container {
    max-width: 640px;
    margin: 0 auto;
    padding: 2rem 1.5rem;
  }
  .summary {
    font-size: 1.05rem;
    line-height: 2;
    color: var(--text-secondary);
    margin-bottom: 2.5rem;
    padding-bottom: 2rem;
    border-bottom: 1px solid var(--border);
  }
  .article {
    margin-bottom: 2.5rem;
  }
  .article-num {
    font-size: 0.68rem;
    font-weight: 600;
    color: var(--text-light);
    letter-spacing: 0.05em;
    margin-bottom: 0.35rem;
  }
  .article-title {
    font-size: 1.2rem;
    font-weight: 700;
    line-height: 1.45;
    margin-bottom: 0.25rem;
  }
  .article-title a {
    color: var(--text);
    text-decoration: none;
    border-bottom: 1px solid transparent;
    transition: border-color 0.2s;
  }
  .article-title a:hover {
    border-bottom-color: var(--text);
  }
  .article-source {
    font-size: 0.78rem;
    color: var(--text-light);
    margin-bottom: 0.7rem;
  }
  .article-tldr {
    font-size: 0.92rem;
    color: var(--text-secondary);
    line-height: 1.9;
    margin-bottom: 0.7rem;
  }
  .tags {
    display: flex;
    flex-wrap: wrap;
    gap: 0.35rem;
    margin-bottom: 0.8rem;
  }
  .tag {
    font-size: 0.68rem;
    font-weight: 500;
    color: var(--text-light);
    background: var(--tag-bg);
    padding: 3px 10px;
    border-radius: 100px;
  }
  .article-excerpt {
    background: var(--excerpt-bg);
    border-radius: 8px;
    padding: 1.1rem 1.3rem;
    margin-top: 0.6rem;
  }
  .article-excerpt .label {
    font-size: 0.68rem;
    font-weight: 600;
    letter-spacing: 0.05em;
    text-transform: uppercase;
    color: var(--text-light);
    margin-bottom: 0.5rem;
  }
  .article-excerpt .text {
    font-size: 0.88rem;
    color: var(--text-secondary);
    line-height: 1.9;
  }
  .article-excerpt .text p { margin-bottom: 0.35rem; }
  .divider {
    height: 1px;
    background: var(--border-light);
    margin: 2.5rem 0;
  }

  /* ── States ── */
  .loading, .error-state {
    text-align: center;
    padding: 4rem 1.5rem;
    color: var(--text-light);
    font-size: 0.9rem;
  }
  .loading .spinner {
    width: 24px; height: 24px;
    border: 2px solid var(--border);
    border-top-color: var(--accent);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
    margin: 0 auto 1rem;
  }
  @keyframes spin { to { transform: rotate(360deg); } }
  .error-state { color: #ff3b30; }

  /* ── Footer ── */
  .footer {
    max-width: 640px;
    margin: 0 auto;
    padding: 2rem 1.5rem 3rem;
    text-align: center;
    font-size: 0.78rem;
    color: var(--text-light);
    border-top: 1px solid var(--border);
  }
  .footer a { color: var(--accent); text-decoration: none; }
  .footer a:hover { text-decoration: underline; }

  @media (max-width: 480px) {
    .header { padding: 2.5rem 1.25rem 1.5rem; }
    .header h1 { font-size: 1.5rem; }
    .container { padding: 1.5rem 1.25rem; }
    .date-nav { padding: 0 1.25rem; padding-bottom: 1.2rem; }
    .article-title { font-size: 1.08rem; }
  }
</style>
</head>
<body>

<div class="header">
  <div class="label">Daily Curated</div>
  <h1>AI 日报</h1>
  <div class="meta">by Moss · auto-curated</div>
</div>

<div class="date-nav">
  <button id="btn-prev" title="前一天">‹</button>
  <div class="date-picker-wrap">
    <div class="date-display" id="date-display">
      <span id="date-text">加载中...</span>
      <span class="arrow">▾</span>
    </div>
    <div class="date-dropdown" id="date-dropdown"></div>
  </div>
  <button id="btn-next" title="后一天">›</button>
</div>

<div id="content">
  <div class="loading">
    <div class="spinner"></div>
    正在加载...
  </div>
</div>

<div class="footer">
  <a href="https://github.com/zyfayes">Moss</a> · Powered by OpenClaw
</div>

<script>
const BASE = './data';
let manifest = [];
let currentIdx = 0;

// ── Escape HTML ──
function esc(s) {
  const d = document.createElement('div');
  d.textContent = s || '';
  return d.innerHTML;
}

// ── Render digest ──
function render(data) {
  let html = `<div class="container">`;
  html += `<div class="summary">${esc(data.summary)}</div>`;

  const articles = data.articles || [];
  articles.forEach((a, i) => {
    const tags = (a.tags || []).map(t => `<span class="tag">${esc(t)}</span>`).join('');
    const excerpt = a.excerpt ? `
      <div class="article-excerpt">
        <div class="label">原文摘要</div>
        <div class="text">${a.excerpt.split('\n').filter(Boolean).map(p => `<p>${esc(p)}</p>`).join('')}</div>
      </div>` : '';
    const divider = i < articles.length - 1 ? '<div class="divider"></div>' : '';

    html += `
      <div class="article">
        <div class="article-num">${String(a.num || i + 1).padStart(2, '0')}</div>
        <div class="article-title"><a href="${esc(a.url)}" target="_blank" rel="noopener">${esc(a.title)}</a></div>
        <div class="article-source">${esc(a.source || '')}</div>
        <div class="article-tldr">${esc(a.tldr)}</div>
        ${tags ? `<div class="tags">${tags}</div>` : ''}
        ${excerpt}
      </div>
      ${divider}`;
  });

  html += `</div>`;
  document.getElementById('content').innerHTML = html;
}

// ── Load a date ──
async function loadDate(date) {
  const content = document.getElementById('content');
  content.innerHTML = '<div class="loading"><div class="spinner"></div>正在加载...</div>';

  try {
    const res = await fetch(`${BASE}/${date}.json`);
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    const data = await res.json();
    document.title = `AI 日报 ${date}`;
    document.getElementById('date-text').textContent = formatDate(date);
    currentIdx = manifest.indexOf(date);
    updateNavButtons();
    updateDropdown();
    render(data);
    history.replaceState(null, '', `?date=${date}`);
  } catch (e) {
    content.innerHTML = `<div class="error-state">无法加载 ${date} 的数据</div>`;
  }
}

// ── Format date for display ──
function formatDate(d) {
  const [y, m, day] = d.split('-');
  const weekdays = ['日', '一', '二', '三', '四', '五', '六'];
  const dt = new Date(d + 'T00:00:00');
  return `${y} 年 ${parseInt(m)} 月 ${parseInt(day)} 日 · 周${weekdays[dt.getDay()]}`;
}

// ── Nav buttons ──
function updateNavButtons() {
  document.getElementById('btn-prev').disabled = currentIdx <= 0;
  document.getElementById('btn-next').disabled = currentIdx >= manifest.length - 1;
}

// ── Dropdown ──
function updateDropdown() {
  const dd = document.getElementById('date-dropdown');
  dd.innerHTML = manifest.slice().reverse().map(d =>
    `<div class="date-item ${d === manifest[currentIdx] ? 'active' : ''}" data-date="${d}">${formatDate(d)}</div>`
  ).join('');
}

// ── Init ──
async function init() {
  try {
    const res = await fetch(`${BASE}/manifest.json`);
    manifest = await res.json();
    if (!manifest.length) {
      document.getElementById('content').innerHTML = '<div class="error-state">暂无数据</div>';
      return;
    }

    // Check URL param
    const params = new URLSearchParams(location.search);
    const requested = params.get('date');
    const target = requested && manifest.includes(requested) ? requested : manifest[manifest.length - 1];

    await loadDate(target);
  } catch (e) {
    document.getElementById('content').innerHTML = '<div class="error-state">加载失败</div>';
  }
}

// ── Events ──
document.getElementById('btn-prev').addEventListener('click', () => {
  if (currentIdx > 0) loadDate(manifest[currentIdx - 1]);
});

document.getElementById('btn-next').addEventListener('click', () => {
  if (currentIdx < manifest.length - 1) loadDate(manifest[currentIdx + 1]);
});

document.getElementById('date-display').addEventListener('click', (e) => {
  e.stopPropagation();
  document.getElementById('date-dropdown').classList.toggle('open');
});

document.getElementById('date-dropdown').addEventListener('click', (e) => {
  const item = e.target.closest('.date-item');
  if (item) {
    loadDate(item.dataset.date);
    document.getElementById('date-dropdown').classList.remove('open');
  }
});

document.addEventListener('click', () => {
  document.getElementById('date-dropdown').classList.remove('open');
});

// Keyboard nav
document.addEventListener('keydown', (e) => {
  if (e.key === 'ArrowLeft' && currentIdx > 0) loadDate(manifest[currentIdx - 1]);
  if (e.key === 'ArrowRight' && currentIdx < manifest.length - 1) loadDate(manifest[currentIdx + 1]);
});

init();
</script>
</body>
</html>
